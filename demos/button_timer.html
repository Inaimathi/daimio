<!doctype html> 
<html> 
<head> 
  <meta charset="utf-8">
  <title>Push My Button! Volume Two</title>
  <script type="text/javascript" src="../get.php?file=daimio"></script>
</head>

<body>

  <div>
    <p>The button has been pushed <span id="counter">0</span> times!</p>
  </div>
  
  <form id="button">
    <p><input type="submit" value="Start counting"></p>
  </form>
  
  <form id="values">
    <p>
      <input id="time-in" type="range" value="1000" min="0" max="2000"> 
      <span id="time-out">1000</span> (delay, in milliseconds)</p>
    <p>
      <input id="step-in" type="range" value="1" min="1" max="1000"> 
      <span id="step-out">1</span> (step size)</p>
  </form>
  
  <h3>The code</h3>
  
  <pre><code>
    outer
      $time 1000
      $step 1
      
      @time-in  dom-on-change
      @time-out dom-set-text

      @step-in  dom-on-change
      @step-out dom-set-text
      
      @counter dom-set-text
      @button  dom-on-submit

      inc      {__ | add $count | $>count}
      block    {$count | then "{process sleep for 10000000}" | run} 
      
      @time-in -> {__ | $>time} -> @time-out
      @step-in -> {__ | $>step} -> @step-out
      
      @button -> block -> inc -> @counter
      inc -> {process sleep for $time | $step} -> inc
  </code></pre>
  
  <h3>The spacial structure</h3>
  
  <pre><code>
    _____________________________________________________________
    |                                                           |
    |                                                           |
    |             ______________________________                |
    |            /                              \               |
    o-----------(  {__ | add $count | $>count}  )--------------o
    |     |      \______________________________/      |        |
    |     ^                                            v        |
    |     ^                                            v        |
    |     |    ___________________________________     |        |
    |     |   /                                   \    |        |
    |     |--(  {process sleep for $time | $step}  )---|        |
    |         \___________________________________/             |
    |                                                           |
    |                                                           |
    |                   _________________                       |
    |                  /                 \                      |
    o-----------------(  {__ | $>time}   )---------------------o
    |                  \_________________/                      |
    |                   _________________                       |
    |                  /                 \                      |
    o-----------------(  {__ | $>step}   )---------------------o
    |                  \_________________/                      |
    |___________________________________________________________|
    
  </code></pre>
  
  
  <script type="text/daimio" id="spaceseeds">

    outer
      $time 1000
      $step 1
      
      @time-in  dom-on-change
      @time-out dom-set-text

      @step-in  dom-on-change
      @step-out dom-set-text
      
      @counter dom-set-text
      @button  dom-on-submit

      inc      {__ | add $count | $>count}
      block    
        {$count 
        | then "{process sleep for 10000000}" 
        | run} 
      // FIXME: block is very very silly
      
      @time-in -> {__ | $>time} -> @time-out
      @step-in -> {__ | $>step} -> @step-out
      
      @button -> block -> inc -> @counter
      inc -> {process sleep for $time | $step} -> inc

  </script>
  
  <script type="text/javascript">    
    document.addEventListener('DOMContentLoaded', function() {
      var seedlikes = document.getElementById('spaceseeds').text
      var outerseed = D.make_some_space(seedlikes)
      OuterSpace = new D.Space(outerseed) // published for debug
    })
  </script>
  
</body>
</html>