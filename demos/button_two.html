<!doctype html> 
<html> 
<head> 
  <meta charset="utf-8">
  <title>Push My Button! Volume Two</title>
  <script type="text/javascript" src="http://sherpa.local/~dann/katsu/nodely/__underscore.js"></script>
  <script type="text/javascript" src="http://sherpa.local/~dann/daimio/get.php?file=node_modules/daml"></script>
</head>

<body>

  <div>
    <p>The button has been pushed <span id="counter">0</span> times!</p>
  </div>
  
  <form id="button1">
    <p><input type="submit" value="add 1"></p>
  </form>
  
  <form id="button2">
    <p><input type="submit" value="add 2"></p>
  </form>
  
  <script type="text/daml" id="hello_daimio">
    {// :counter | gateway dom-set-text thing __}
    {// :button | gateway dom-submit thing __}
    {// why doesn't @button1 → "1" work? //}
  
    {:counter | gateway add type :dom-set-text thing __}

    {:button1 | gateway add type :dom-submit thing __}
    {:button2 | gateway add type :dom-submit thing __}

    {({@button1 → "{1}"}
      {@button2 → "{2}"})
    → "{__ | add $count | > :count}"
    → @counter}
 
  </script>
  
  <script type="text/javascript">    
    document.addEventListener('DOMContentLoaded', function() {
      var code = document.getElementById('hello_daimio')
      DAML.run(code.text, function() {})
    })
  </script>
  
  <!-- 
  
    DAML.run('{space add name :ticker block "{process sleep for 1000 then 1}" | gateway add name :tickergateway type :space | channel attach-to-end name :button-to-space | channel attach-to-start gateway :tickergateway}')
    
    DAML.run('{space add name :ticker block "{process sleep for 1000 then 1}"}')
    DAML.run('{gateway add name :tickergateway type :space thing :ticker}')
    DAML.run('{channel attach-to-end name :button-to-space gateway :tickergateway}')
    DAML.run('{channel attach-to-start name :button-to-space gateway :tickergateway}')
  
    DAML.run('{range 500 | map block "{__ | process wait for 1 | times __ | channel send name :counter}"}')
    {//3 | process wait for 1000 | add 99}
    {3 | process wait for 1000 then "{__}" | add 99}
    
    {48 | @>counter}
    
    
   -->
</body>
</html>