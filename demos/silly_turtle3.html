<!doctype html> 
<html> 
<head> 
  <meta charset="utf-8">
  <title>I Like Turtles</title>
  <script type="text/javascript" src="http://sherpa.local/~dann/daimio/node_modules/underscore/underscore.js"></script>
  <script type="text/javascript" src="http://sherpa.local/~dann/daimio/get.php?file=node_modules/daml"></script>
</head>

<body>

  <svg id="mainsvg" width="800px" height="500px" viewBox="0 0 800 500"></svg>
  
  <div style="float:right; width: 320px; overflow: auto">
    <pre id="hints">
      
{forward 10} {turn 10}

{forward 10 | turn 10}

{10 | forward | turn}

{ 120 | forward | turn 
| forward | turn | forward | turn}

{90 | forward | turn}

{range 4 | do "{90 | forward | turn}"}

Other math commands:
{math mod value 7 by 2}
{math pow value 2 exp 8}
{math sin value 90}
{math cos value 90}
{math round value 1.234}

    </pre>
  </div>
  
  <form id="codeform">
    <div><textarea id="code" name="code" rows="4" cols="100"></textarea></div>
    <div><input type="submit" name="send" value="send" id="send" /></div>
  </form>
  
  <pre id="morehints">
    
{range 36 | do "{turn 10 | range 4 | do "{90 | forward | turn | wait}"}"}

{range 400 | do "{__ | times 0.04 | add 3.2 | forward | turn 14.2 | wait}"}

{7 | range 200 | do "{__ | divide value 200 | forward | turn -16.3 | wait}"}

{range 10 | do "{range 9 | do "{forward 100 | turn 200 | wait}" | turn 36}"}

{range 4 | do "{range 100 | list reverse | do "{__ | turn | forward 10 | wait}" | turn 60}"}

{range 400 | do "{forward 5 | math randomÂ max 4 | times 90 | turn | wait}"}

  </pre>
  
  <!-- {range 4 | do "{turn 100 | range 100 | list reverse | do "{__ | turn | forward 10 | wait}"}"} -->
  
  
  <script type="text/json" id="spaceseeds">
    { execspace:
      { dialect: {}
      , ports: 
        { "execport": ["exec"]
        , "forward": ["out"]
        , "turn": ["out"]
        }
      }
      
    , outer: 
      { ports: 
        { "codeform": ["dom-submit-track"]
        , "svg-move": ["svg-move"]
        , "svg-rotate": ["svg-rotate"]
        , "svg-line-add": ["svg-line-add"]
        , "socket-user-add": ["socket-user-add"]
        , "socket-user-remove": ["socket-user-remove"]
        , "socket-in": ["socket-in"]
        , "socket-out": ["socket-out"]
        , "turtle-add": ["turtle-add"]
        }
      , state: 
        { colors: ["aliceblue", "aqua", "aquamarine", "azure", "blue", "blueviolet", "brown", "burlywood", "cadetblue", "chartreuse", "chocolate", "coral", "cornflowerblue", "crimson", "cyan", "darkblue", "darkcyan", "darkgoldenrod", "darkgreen", "darkkhaki", "darkmagenta", "darkolivegreen", "darkorange", "darkorchid", "darkred", "darksalmon", "darkseagreen", "darkslateblue", "darkturquoise", "darkviolet", "deeppink", "deepskyblue", "dodgerblue", "firebrick", "forestgreen", "fuchsia", "gainsboro", "gold", "goldenrod", "green", "greenyellow", "honeydew", "hotpink", "indianred", "indigo", "lavender", "lavenderblush", "lawngreen", "lemonchiffon", "lime", "limegreen", "linen", "magenta", "maroon", "midnightblue", "mintcream", "mistyrose", "moccasin", "navy", "oldlace", "olive", "olivedrab", "orange", "orangered", "orchid", "palegoldenrod", "palegreen", "paleturquoise", "palevioletred", "papayawhip", "peachpuff", "peru", "pink", "plum", "powderblue", "purple", "red", "rosybrown", "royalblue", "saddlebrown", "salmon", "sandybrown", "seagreen", "seashell", "sienna", "silver", "skyblue", "slateblue", "snow", "springgreen", "steelblue", "teal", "thistle", "tomato", "turquoise", "violet", "yellowgreen"]}
      , subspaces: 
        { execs: "execspace"}
      , stations: // TODO: needs A) line breaks B) a "between" command C) var access sugar D) var setting sugar
        { forward_fix: '{__ | > :ship | $turtles.{$ship.user}.x | > :oldx | $turtles.{$ship.user}.y | > :oldy | $turtles.{$ship.user}.angle | add 90 | math cos | times $ship.result | > :dx | add $turtles.{$ship.user}.x | > {"turtles.{$ship.user}.x" | run} | less than 0 | then 0 else $turtles.{$ship.user}.x | > {"turtles.{$ship.user}.x" | run} | 750 | less than $turtles.{$ship.user}.x | then 750 else $turtles.{$ship.user}.x | > {"turtles.{$ship.user}.x" | run} | $turtles.{$ship.user}.angle | add 90 | math sin | times $ship.result | > :dy | add $turtles.{$ship.user}.y | > {"turtles.{$ship.user}.y" | run} | less than 0 | then 0 else $turtles.{$ship.user}.y | > {"turtles.{$ship.user}.y" | run} | 450 | less than $turtles.{$ship.user}.y | then 450 else $turtles.{$ship.user}.y | > {"turtles.{$ship.user}.y" | run} | * (:y $turtles.{$ship.user}.y :x $turtles.{$ship.user}.x :thing {"turtlebox{$ship.user}" | run}) | port send name :svg-move | * (:y1 {$oldy | add 15} :x1 {$oldx | add 15} :x2 {$turtles.{$ship.user}.x | add 15} :y2 {$turtles.{$ship.user}.y | add 15} :color $turtles.{$ship.user}.color :alpha $turtles.{$ship.user}.alpha :thing :mainsvg) | port send name :svg-line-add}'
        , turn_fix: '{__ | > :ship | * (:angle {$turtles.{$ship.user}.angle | add $ship.result | > {"turtles.{$ship.user}.angle" | run}} :thing {"turtle{$ship.user}" | run}) | @> :svg-rotate}'
        , turtle_fix: '{__ | > :ship | $colors.{$ship.user | times 13 | mod {$colors | count}} | > :ship.color | * (:angle 0 :x 200 :y 200 :alpha 0.8 :color $ship.color) | > {"turtles.{$ship.user}" | run} | $ship}'
        }
      , routes: 
        [ ['codeform', 'socket-out']
        // , ['cleaner.out', 'execs.execport'] 
        , ['socket-in', 'execs.execport'] 
        , ['execs.forward', 'forward_fix.in']
        , ['execs.turn', 'turn_fix.in']
        , ['socket-user-add', 'turtle_fix.in']
        , ['turtle_fix.out', 'turtle-add']
        ]
      }
    }
    // yicky yick this is ugly
  </script>
  
  <script src="/socket.io/socket.io.js"></script>
  <script type="text/javascript">    
    document.addEventListener('DOMContentLoaded', function() {
      socket = io.connect('http://sherpa.local:8008') // published for demo (icky)
      
      eval('var seedlikes = ' + document.getElementById('spaceseeds').text) // OH NO WHY ARE YOU DOING THIS
      var outerseed = DAML.make_some_space(seedlikes)
      OuterSpace = new DAML.Space(outerseed) // published for debug
    })
    
    
    /*
      TODOS!!!
      -- exec port
      -- lines working
      -- turtle line working
      -- network (websockets / webrtc) stuff... like USER
      -- code sending working
      -- new turtle per user
      -- good job
      
      - audio code
      - cm editor for turtle code
      - pause space
      - svg display of spaces
      - spacial processing limits
      - concurrency code (turtle intersection?)
      - live updates
    */
    
  </script>
  
</body>
</html>