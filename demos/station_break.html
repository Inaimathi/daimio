<!doctype html> 
<html> 
<head> 
  <meta charset="utf-8">
  <title>Station Break</title>
  <script type="text/javascript" src="http://sherpa.local/~dann/daimio/node_modules/underscore/underscore.js"></script>
  <script type="text/javascript" src="http://sherpa.local/~dann/daimio/get.php?file=node_modules/daml"></script>
</head>

<body>

  <div>
    <p>Current count: <span id="count"></span></p>
    <p>Mod two? <span id="modtwo-yes"></span> <span id="modtwo-no"></span></p>
    <p>FB: <span id="fizz"></span><span id="buzz"></span></p>
  </div>
  
  <form id="button1"><p><input type="submit" value="inc"></p></form>
  <form id="button2"><p><input type="submit" value="dec"></p></form>
  
  <script type="text/daml" id="spaceseeds">

    outer
      $count 11
      
      @fizz       dom-set-text
      @buzz       dom-set-text
      @count      dom-set-text
      @modtwo-no  dom-set-text
      @modtwo-yes dom-set-text

      @button1 dom-on-submit
      @button2 dom-on-submit
      
      modthree {__ | mod 3 | then "" else :fizz}
      modfive  {__ | mod 5 | then "" else :buzz}
      modtwo   {__ | mod 2 | then "{__ | @>twono}" else "{__ | @>twoyes}" with __}
      
      twono    {""   | @>modtwo-yes | :No | @>modtwo-no}
      twoyes   {:Yes | @>modtwo-yes | ""  | @>modtwo-no}
      
      counter {__ | add $count | $>count}
      
      foo {123 | process downport name :argh | tap}
      @button1 -> foo
      foo.argh -> @count
      
      @button1 -> {1}  -> counter
      @button2 -> {-1} -> counter
      
      counter -> @count
      counter -> modthree -> @fizz
      counter -> modfive  -> @buzz
      counter -> modtwo
      
      modtwo.twono     -> twono
      twono.modtwo-no  -> @modtwo-no
      twono.modtwo-yes -> @modtwo-yes

      modtwo.twoyes     -> twoyes
      twoyes.modtwo-no  -> @modtwo-no
      twoyes.modtwo-yes -> @modtwo-yes

      // the above is super convoluted in order to test various messy port-related things

      // so we want to move count into a box. we need a generic command for accessing downward ports. 

  </script>
   
  
  <script type="text/javascript">    
    document.addEventListener('DOMContentLoaded', function() {
      var seedlikes = document.getElementById('spaceseeds').text
      var outerseed = DAML.make_some_space(seedlikes)
      OuterSpace = new DAML.Space(outerseed) // published for debug

      // var code = document.getElementById('hello_daimio')
      // DAML.run(code.text, function() {})
    })
  </script>
  
</body>
</html>